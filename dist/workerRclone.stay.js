var e,isEmptyStr=function(e){return""===e},isEmptyObj=function(e){if(e===undefined)return!1;if(null===e)return!0;for(var t in e)return!1;return!0},isInteger=function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e},isZero=function(e){return null!=e&&("0"===e||0===e)},t={fg:{black:"30",red:"31",green:"32",yellow:"33",blue:"34",magenta:"35",cyan:"36",white:"37",def:"39"},bg:{black:"40",red:"41",green:"42",yellow:"43",blue:"44",magenta:"45",cyan:"46",white:"47",def:"49"}},getEscSeq=function(e){return e?"\\x1b[":"["},colorlize=function(e){var n=e.message,r=e.esc,i=void 0!==r&&r,o=e.fg,a=e.bg;if(isEmptyStr(n))return"";var c=getEscSeq(i);return!o||isEmptyStr(o)?""+n:""+(""+c+(a?t.bg[a]+";":"")+t.fg[o]+"m")+n+c+"49;39m"},cursorMove=function(e,t,n){void 0===e&&(e="u"),void 0===n&&(n=!1);var r={u:"A",d:"B",l:"C",r:"D"}[e];if(!r)throw new Error('The direction value is incorrect. Valid value is "u", "d", "l", "r"');return""+getEscSeq(n)+t+r},n={logCount:1,log:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=t.length>0?t.join(", "):"";0!==PPx.Execute('%OC %"DEBUG_LOG"%Q"['+this.logCount+"] %("+String(r)+'%)"')&&PPx.Quit(-1),this.logCount++},"break":function(){return PPx.Quit(-1)},exists:function(e,t){void 0===t&&(t="file");PPx.CreateObject("Scripting.FileSystemObject")},wait:function(e){PPx.Execute("*wait "+e+",2")},func:function(e){e()},jestRun:function(){return"object"==typeof process&&"test"===process.env.NODE_ENV}},validArgs=function(){for(var e=[],t=PPx.Arguments;!t.atEnd();t.moveNext())e.push(t.value);return e},r={ppmName:"ppx-plugin-manager",ppmVersion:.95,language:"ja",encode:"utf16le",nlcode:"\r\n",nltype:"crlf",ppmID:"P",ppmSubID:"Q"},i={actions:"S_ppm#actions",event:"S_ppm#event",global:"S_ppm#global",sources:"S_ppm#sources",staymode:"S_ppm#staymode",user:"S_ppm#user"},useLanguage=function(){var e=PPx.Extract("%*getcust("+i.global+":lang)");return"en"===e||"ja"===e?e:r.language},o={storeData:8e4,veHandler:80001,setsel:80002,stackPPb:80003},a=PPx.CreateObject("Scripting.FileSystemObject");String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/,"")}),Array.prototype.removeEmpty||(Array.prototype.removeEmpty=function(){for(var e=[],t=0,n=this.length;t<n;t++){var r=this[t];null==r||""===r||r instanceof Array&&0===r.length||r instanceof Object&&isEmptyObj(r)||e.push(r)}return e}),Array.prototype.indexOf||(Array.prototype.indexOf=function(e,t){var n;if(null==this)throw new Error('Array.indexOf: "this" is null or not defined');var r=Object(this),i=r.length>>>0;if(0===i)return-1;var o=null!=t?t:0;if(Math.abs(o)===Infinity&&(o=0),o>=i)return-1;for(n=Math.max(o>=0?o:i-Math.abs(o),0);n<i;){if(n in r&&r[n]===e)return n;n++}return-1});var c,u=(c=PPx.Extract("%*getcust(S_ppm#global:git)"),isEmptyStr(c)?"echo":'"'+c+'\\usr\\bin\\echo.exe"'),winpos=function(e,t,n){return isInteger(t)&&isInteger(n)?"*windowposition "+e+","+(t<0?0:t)+","+(n<0?0:n):""},winsize=function(e,t,n){return isInteger(t)&&isInteger(n)?"*windowsize "+e+","+(t<200?200:t)+","+(n<200?200:n):""},_runCmdline=function(e){var t=e.startwith,n=void 0===t?"":t,r=e.wait,i=void 0===r?"":r,o=e.startmsg,a=void 0===o||o,c=e.priority,u=e.breakjob,p=e.newgroup,s=e.log,l=e.wd,d=e.x,x=e.y,P=e.width,f=e.height,m={"":"",min:"-min",max:"-max",noactive:"-noactive",bottom:"-noactive"}[n],g={"":"",wait:"-wait",idle:"-wait:idle",later:"-wait:later",no:"-wait:no"}[i],b="";if(l){if(!PPx.CreateObject("Scripting.FileSystemObject").FolderExists(l))return[!1,["[WARN] Specified working directory is not exist"]];b="-d:"+l}var v=a?"":"-nostartmsg",E=c?"-"+c:"",h=u?"-breakjob":"",y=p?"-newgroup":"",w=s?"-log":"",S=PPx.Extract("%*getcust(S_ppm#global:disp_width)"),_=PPx.Extract("%*getcust(S_ppm#global:disp_height)");return d&&d>Number(S)&&(d=0),x&&x>Number(_)&&(x=0),[!0,["*run","-noppb",m,g,v,E,h,y,w,b,d&&x?"-pos:"+d+","+x:"",P&&f?"-size:"+P+","+f:""]]},_ppbCmdline=function(e){var t=e.bootid,n=e.bootmax,r=e.q,i=e.c,o=e.k;return{id:t?"-bootid:"+t:"",max:n?"-bootmax:"+n:"",quiet:r?"-q":"",postcmd:i||(o||"")}},runPPb=function(e){var t=e.bootid,n=e.bootmax,r=e.q,i=e.c,o=e.k,a=e.startwith,c=void 0===a?"":a,p=e.wait,s=void 0===p?"":p,l=e.priority,d=e.breakjob,x=e.newgroup,P=e.log,f=e.wd,m=e.x,g=e.y,b=e.width,v=e.height,E=e.desc,h=e.fg,y=e.bg;if(-1!==PPx.Extract("%*ppxlist(-B)").indexOf("B_"+t))return PPx.Execute("*focus B"+t),!0;var w=_runCmdline({startwith:c,wait:s,priority:l,breakjob:d,newgroup:x,log:P,wd:f}),S=w[0],_=w[1];if(!S)return!1;var k=_ppbCmdline({bootid:t,bootmax:n,q:r,c:i,k:o}),j=[];"min"===c||"max"===c||i||(j.push(winpos("%%n",m,g)),j.push(winsize("%%n",b,v)),"bottom"!==c||i||j.push("*selectppx %n")),E&&!isEmptyStr(E)&&j.push(u+' -e "'+colorlize({esc:!0,message:E,fg:h,bg:y})+'"'),j.push(k.postcmd);var D="";j.length>0&&(D=(i?"-c ":"-k ")+j.removeEmpty().join("%%:"));var C=[].concat(_,["%0ppbw.exe",k.id,k.max,k.quiet]).removeEmpty().join(" "),O=!0;try{/^-k $/.test(D)&&(D=""),PPx.Execute(C+" "+D+"%:*wait 500,2")}catch(F){O=!1}return O},ppx_Discard$1=function(e,t){var n;PPx.StayMode=0,t=null!=(n=t)?n:"","DEBUG"===e&&PPx.linemessage("[DEBUG] discard "+t)},p=["KC_main","KV_main","KV_img","KV_crt","KV_page","KB_edit","K_ppe","K_edit","K_lied"],_validTable=function(e){return~p.indexOf(e)?e:"KC_main"},_linecust=function(e,t,n){return"*linecust "+e+","+t+":"+n+","},_discard=function(e){return function(t){var n=t.table,r=t.label,i=t.mapkey,o=t.cond,a=void 0===o?"instantly":o,c=t.debug,u=void 0===c?"0":c,p=PPx.StayMode,s=PPx.Extract("%n"),l=PPx.Extract('%*name(C,"%FDV")'),d=_validTable(n),x=_linecust(""+r+s,d,e),P=_linecust(""+r+s,d,"CLOSEEVENT"),f={instantly:"",once:'*if("'+s+'"=="%n")%:',hold:'*if("'+s+'"=="%n")&&("'+l+'"!="%*name(C,"%FDV")")%:'},m=[x,P];i&&(PPx.Execute("*mapkey use,"+i),m.push("*mapkey delete,"+i)),m.push('*js ":'+p+',ppx_Discard",'+u+","+r),PPx.Execute(x+"%(*if %*stayinfo("+p+")%:"+f[a]+m.join("%:")+"%)"),PPx.Execute(P+"%("+f.once+P+"%:"+x+"%)"),PPx.Execute('*launch -breakjob -nostartmsg -wait:no %0pptrayw.exe -c %%K"@LOADCUST"')}},getStaymodeId=function(e){e=~e.indexOf(".")?e.slice(0,e.indexOf(".")):e;var t=Number(PPx.Extract("%*getcust(S_ppm#staymode:"+e+")"));return!isNaN(t)&&t>1e4&&t},s=(_discard("ACTIVEEVENT"),_discard("LOADEVENT"),function(e,t,n,r,i){var o="*linecust "+n+","+_validTable(e),a=o+":"+t+",",c={instantly:"",once:'*if("%n"=="%%n")',hold:'*if("%n"=="%%n")&&("%FDV"=="%%FDV")'}[i];PPx.Execute(o+":"+t+","+c+"%%:"+a+"%%:"+r),PPx.Execute('%K"@LOADCUST"')}),l="Drives",d="workerRclone",x="ppm-rclone",P="rc_encrypt",f=getStaymodeId(d)||80110,getRemotePath=function(e){var t=PPx.Extract(e);return t.slice(t.indexOf(l)+l.length+1)},getPassCmd=function(){if(!("1"===PPx.Extract("%*getcust(S_ppm#user:"+P+")")))return[!1,""];var e=isEmptyStr(PPx.Extract("%*getcust(_IDpwd:"+l+")"))?'%k"&s&p"%:':"",t=PPx.Extract(e+"%*pass");return isEmptyStr(t)?[!0,""]:[!1,'--password-command="echo '+t+'"']},m={en:{couldNotGetPass:"Could not get decryption pass",inputTitle:"Enter decrypted password",error:"Cancelled",changeModTime:"Change modification time",overCatSize:"Canceled due to viewing size limit"},ja:{couldNotGetPass:"暗号化解除パスを取得できませんでした",inputTitle:"複合化パスワードの入力",error:"中止しました",changeModTime:"更新時刻の変更",overCatSize:"閲覧サイズ上限により中止しました"}},g=1048576,b="K_ppmRclone",v="ppm_rclone_spin",E="remotes.xlf",h="tmp.xlf",y='%sgu"ppmlib"\\spinner.js',w="-nostartmsg -breakjob -wait:no",cache={base:PPx.Extract("%*base").split(" ")[0],ls2lf:PPx.Extract("%*ls2lf"),lfdir:PPx.Extract("%*lfdir"),ttl:6e4*Number(PPx.Extract("%*ttl")),stackdirection:PPx.Extract("%*stackdirection"),stackwidth:PPx.Extract("%*stackwidth"),ppvid:null!=(e=PPx.Extract("%*ppvid"))?e:"R",ppcid:PPx.Extract("%n"),regenerate:""},S=m[useLanguage()],main=function(){var e;a.FolderExists(cache.lfdir)||PPx.Execute("*makedir "+cache.lfdir);var t=getPassCmd();if(e=t[0],cache.passcmd=t[1],e)return statusMsg(S.couldNotGetPass),clearAuthentication(),"";var n=validArgs(),r=n[0],i=n[1];return cache.startwith=null!=r?r:"bottom",cache.spinner=isEmptyStr(i)?undefined:i,cache.running="setup",PPx.StayMode=f,executeAt(cache.ppcid,"*string i,"+d+"="+f+"%:*mapkey use,"+b),ppx_resume()},ppx_resume=function(){cache.ppbid&&!isEmptyStr(PPx.Extract("%N"+cache.ppbid))||startPPb(),executeAt(cache.ppcid,"*string i,RootPath="+cache.base),cache.wd=PPx.Extract("%*path").slice(l.length+1);var e=-1===cache.wd.indexOf(":"),t=getListFilePath(e);if(!cache.running&&isEmptyStr(cache.regenerate))return t;ppx_StopRunning();var n=generateLs2lfCmd(e);if(a.FileExists(t)){if(isEmptyStr(cache.regenerate)&&withinMinutes(t))return t}else PPx.Extract("%*extract("+cache.ppbid+',"echo ;ListFile>'+t+'%%&")');return asyncRclone(n,t),t},ppx_GetValue=function(e){return cache[e]},ppx_SetValue=function(e,t){cache[e]=t},ppx_RegenScore=function(e){cache.regenerate=isZero(e)?cache.regenerate.slice(0,-1):cache.regenerate+"1"},ppx_StopRunning=function(){showSpinner(!1),PPx.Execute("*signal "+cache.ppbid+",kill"),"ppv"===cache.running&&PPx.Execute("*closeppx V"+cache.ppvid),cache.running=undefined},ppx_Resolve=function(e,t){showSpinner(!1),"0"===e?(PPx.Execute("*launch -noppb -hide -nostartmsg -wait copy /Y "+cache.lfdir+"\\"+cache.ppcid+h+" "+t),PPx.Execute("*jumppath -savelocate"),executeAt(cache.ppbid,"*linemessage "+cursorMove("u",3))):statusMsg(S.error),cache.running=undefined},ppx_ChangeModTime=function(){var e=new Date(PPx.Entry.DateLastModified).toLocaleString(),t=PPx.Extract("%*now").replace(" ","T"),n=PPx.Extract('%*input("'+t+'" -title:"'+S.changeModTime+" [ "+e+' ]" -mode:g)');if(!isEmptyStr(n)){ppx_RegenScore(1);var r=getRemotePath("%FDC"),i="rclone "+cache.passcmd+' touch "'+r+'" --localtime -Ct '+n+"%:%K"+cache.ppcid+'"@F5"';PPx.Execute("*script %sgu'ppmlib'\\stackPPb.stay.js,"+cache.stackwidth+","+cache.stackdirection+",%("+i+"%)")}},ppx_CatFile=function(e){if(isEmptyStr(PPx.getIValue(v))&&isZero(PPx.Extract("%*stayinfo("+o.stackPPb+")")))if(PPx.Entry.Size>(isEmptyStr(e)?g:Number(e)))statusMsg(S.overCatSize);else{showSpinner(!0);var t=getRemotePath("%1%\\%R");PPx.Execute("*launch "+w+" rclone "+cache.passcmd+" cat "+t+"|%0ppvw.exe -bootid:"+cache.ppvid+" -k *execute "+cache.ppcid+",*string i,"+v+"="),cache.running="ppv"}},ppx_Config=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];if("encryption"===t[0]){var r,i="";if(!("remove"===(null==t?void 0:t[1]))&&(i=PPx.Extract('%*input(-title:"'+S.inputTitle+'" -mode:e)'),isEmptyStr(i)))return;PPx.Execute("rclone "+cache.passcmd+" config encryption remove%&"),clearAuthentication(),isEmptyStr(i)?(r="0",cache.passcmd=""):(r="1",cache.passcmd='--password-command="echo '+i+'"',PPx.Execute("rclone "+cache.passcmd+" config encryption set")),PPx.Execute("*setcust S_ppm#user:"+P+"="+r)}else{var o="-noppb -nostartmsg -breakjob";PPx.Execute("*launch "+o+" %0ppbw -c @rclone "+cache.passcmd+" config "+t.join(" "))}},ppx_Discard=function(){showSpinner(!1),PPx.StayMode=0,"prog"===cache.running&&ppx_StopRunning(),cache.running=undefined,executeAt(cache.ppcid,"*string i,"+d+"=%:*mapkey delete,"+b),closePPb()},ppx_finally=function(){showSpinner(!1),closePPb(),n&&PPx.Echo("[DEBUG] "+PPx.StayMode+": finally")},statusMsg=function(e){return executeAt(cache.ppcid,'*linemessage !"'+e)},executeAt=function(e,t){PPx.Execute("*execute "+e+",%("+t+"%)")},getListFilePath=function(e){var t=e?E:cache.wd.replace(/[:\/]/g,"_")+".xlf";return cache.lfdir+"\\"+t},withinMinutes=function(e){var t=a.GetFile(e).DateLastModified,n=new Date;return 0>Number(n)-Number(t)-cache.ttl},showSpinner=function(e){cache.spinner&&(e?PPx.Execute("%Obdq *ppb -c *script "+y+","+cache.ppcid+","+cache.spinner+","+v):executeAt(cache.ppcid,"*string i,"+v+"="))},startPPb=function(){var e=PPx.Extract("%*script(\"%sgu'ppmlib'\\expandSource.js\",ppm-rclone,version)");runPPb({startwith:cache.startwith,wd:cache.lfdir,x:10,y:10,k:"*execute "+cache.ppcid+',*js ":'+f+',ppx_SetValue",ppbid,%%n',desc:x+"["+cache.ppcid+"] version "+e,fg:"cyan"})},closePPb=function(){PPx.Execute("*closeppx "+cache.ppbid)},clearAuthentication=function(){PPx.Execute("*clearauth%:*deletecust _IDpwd:"+l)},generateLs2lfCmd=function(e){var t=cache.lfdir+"\\"+cache.ppcid+h;return e?cache.ls2lf+' -c "F" '+t+" rclone "+cache.passcmd+" listremotes":cache.ls2lf+' -j "A:Attr,d:IsDir,S:Size,W:ModTime,F:Name" '+t+" rclone "+cache.passcmd+" lsjson "+cache.wd},asyncRclone=function(e,t){var n="*linemessage loading...";cache.running="prog",cache.regenerate="",showSpinner(!0),executeAt(cache.ppbid,n+"%:*launch "+w+" "+e+"%:*execute "+cache.ppcid+',*js ":'+f+',ppx_Resolve",%*exitcode,"'+t+'"')};PPx.result=main();
